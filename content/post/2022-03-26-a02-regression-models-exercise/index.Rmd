---
title: 'A02: Regression Models Exercise'
author: ''
date: '2022-03-26'
slug: a02-regression-models-exercise
categories: []
tags: []
---
# Executive Summary
A machine learning professor wants to apply his skills towards developing a model to price diamonds so he can determine if he is getting a fair price for an engagement ring he wants to buy. He determined that the variables used in pricing a diamond are color, cut, carat weight, clarity, polish, symmetry, and certification. He has collected data from three different diamond websites to assist us in developing a multiple regression model to predict the price of a diamond ring of his interest.
INCLUDE LAST LINE OF SUMMARY OF MODEL

# Issues and challenges 
In order to develop a multiple regression model, it is important to have a combination of metric variables and the categorical variables that are ordinally scaled. This means it is important to determine how the data in the categorical variables will be grouped.

# Setup
```{r}
if(!require("pacman")) install.packages("pacman")
pacman::p_load(pacman,readxl, magrittr, productplots, psych, RColorBrewer, tidyverse, boot)
diamonds <- read_csv("https://raw.githubusercontent.com/vsomesula/COPwebsite/main/content/post/2022-03-26-a02-regression-models-exercise/Professor_Proposes_Data.csv")
diamonds
```
```{r,echo=FALSE}
diamonds <- read_excel("C:/Users/prana/Downloads/Professor_Proposes_Data.xlsx")
```
```{r}
attach(diamonds)
diamonds$Colour <- as.factor(Colour)
diamonds$Clarity <- as.factor(Clarity)
diamonds$Cut <- as.factor(Cut)
diamonds$Certification <- as.factor(Certification)
diamonds$Polish <- as.factor(Polish)
diamonds$Symmetry <- as.factor(Symmetry)
diamonds$Wholesaler <- as.factor(Wholesaler)
diamonds
```
#Graphing and frequency counting of each variable
```{r}
diamonds %>%
  ggplot() +
  geom_bar(aes(Carat, fill =  Carat)) +
  theme(
    axis.title.x = element_blank(),
    legend.position = "none"
  )
count(diamonds, Carat)

diamonds %>%
  ggplot() +
  geom_bar(aes(Colour, fill =  Colour)) +
  theme(
    axis.title.x = element_blank(),
    legend.position = "none"
  )
count(diamonds, Colour)

diamonds %>%
  ggplot() +
  geom_bar(aes(Clarity, fill =  Clarity)) +
  theme(
    axis.title.x = element_blank(),
    legend.position = "none"
  )
count(diamonds, Clarity)

diamonds %>%
  ggplot() +
  geom_bar(aes(Cut, fill =  Cut)) +
  theme(
    axis.title.x = element_blank(),
    legend.position = "none"
  )
count(diamonds, Cut)

diamonds %>%
  ggplot() +
  geom_bar(aes(Certification, fill =  Certification)) +
  theme(
    axis.title.x = element_blank(),
    legend.position = "none"
  )
count(diamonds, Certification)

diamonds %>%
  ggplot() +
  geom_bar(aes(Polish, fill =  Polish)) +
  theme(
    axis.title.x = element_blank(),
    legend.position = "none"
  )
count(diamonds, Polish)

diamonds %>%
  ggplot() +
  geom_bar(aes(Symmetry, fill =  Symmetry)) +
  theme(
    axis.title.x = element_blank(),
    legend.position = "none"
  )
count(diamonds, Symmetry)

diamonds %>%
  ggplot() +
  geom_bar(aes(Wholesaler, fill =  Wholesaler)) +
  theme(
    axis.title.x = element_blank(),
    legend.position = "none"
  )
count(diamonds, Wholesaler)

```
# Explaotory Analysis
## This type of model will give us an equation where we can use as many of the categorial variables as we want. We can imagine it as CutGx1 + CutIx2 + .. with their respective coefficents. With each duiamond if it has Cut level of G than x2, x3, etc for that category will be 0 leaving us only with the weight for Cut G. This will leave us a very convuluted model however as seen below. We will remove wholesaler as it is three different websites from which the information was obtained which means it should be three different models (i.e. wholesaler is not an indepdent variable)
```{r}
lm.fit <- lm(Price~Carat + Colour + Clarity +Cut + Certification + Polish + Symmetry, data = diamonds)
summary(lm.fit)
```
## We can use this model for testing however through code to see the results. In a completely accurate world, if we had the wholesaler from which the professor was buying from (assuming it was 1,2, or 3) we could make three different models and see if he was getting a fair price for his diamond
```{r}
df <- data.frame(Carat = 0.9, Colour = "J", Clarity = "SI2", Cut = "V", Certification = "GIA", Polish = "G", Symmetry = "V")
as_tibble(df)
df$Colour <- as.factor(df$Colour)
df$Clarity <- as.factor(df$Clarity)
df$Cut <- as.factor(df$Cut)
df$Certification <- as.factor(df$Certification)
df$Polish <- as.factor(df$Polish)
df$Symmetry <- as.factor(df$Symmetry)
#df$Wholesaler <- as.factor(df$Wholesaler)
df
predict(lm.fit, df )
```
# Boot strap validation
```{r}
boot.fn <- function(data, index){
  return(coef(lm(Price~Carat + Colour + Clarity +Cut + Certification + Polish + Symmetry+Wholesaler, data = diamonds)))
}
set.seed(1)
boot.out <- boot(diamonds, boot.fn, 1000)
plot(boot.out)
```
# K fold validation will not work unless we use stratified sort or use dummy variables
```{r, error=TRUE}
K = 10
glm.fit <- glm(Price~ Carat + Colour + Clarity +Cut + Certification + Polish + Symmetry, data =  diamonds)
cv.error <- cv.glm(diamonds, glm.fit, K = K)$delta[1]

```




<!-- ### Junk Transformation of Colour variable so that the groups of letter all correspond to the correct grouping -->
<!-- ```{r} -->
<!-- for(v in 1:440){ -->
<!-- if(diamonds$Colour[v] == "D"|| diamonds$Colour[v] == "E"|| diamonds$Colour[v] == "F") -->
<!-- { -->
<!--   diamonds$Colour[v] = 1 -->
<!-- } else if(diamonds$Colour[v] == "G"|| diamonds$Colour[v] == "H"|| diamonds$Colour[v] == "I") { -->
<!--   diamonds$Colour[v] = 2 -->

<!-- } else if(diamonds$Colour[v] == "J"|| diamonds$Colour[v] == "K") { -->
<!--   diamonds$Colour[v] = 3 -->

<!-- } else if(diamonds$Colour[v] == "L"|| diamonds$Colour[v] == "M"|| diamonds$Colour[v] == "N") { -->
<!--   diamonds$Colour[v] = 4 -->

<!-- } else if(diamonds$Colour[v] == "O"|| diamonds$Colour[v] == "P"|| diamonds$Colour[v] == "Q"|| diamonds$Colour[v] == "R"|| diamonds$Colour[v] == "S") { -->
<!--   diamonds$Colour[v] = 5 -->

<!-- } else  { -->
<!--   diamonds$Colour[v] = 6 -->

<!-- }  -->

<!-- } -->
<!-- ``` -->






<!-- #### Junk -->
<!-- ```{r} -->
<!-- diamonds <- read_excel("C:/Users/prana/Downloads/Professor_Proposes_Data.xlsx") -->
<!-- attach(diamonds) -->
<!-- diamonds$Colour[1] = "I" -->
<!-- if(diamonds$Colour[5] == "I" || diamonds$Colour[5] == "J") -->
<!-- { -->
<!--   diamonds$Colour[5] = 1 -->
<!-- } -->
<!-- diamonds$Colour[5] -->
<!-- #lm.fit <- lm(Price ~ Cut, data = diamonds) -->
<!-- #lm.fit -->



<!-- diamond_col_name <- colnames(diamonds) -->

<!-- #for (d in 1:9) { -->
<!--  # if(d !==8){ -->
<!--   #  lmfao[d] <- diamond_col_name[d] -->
<!--    # ggplot(diamonds, aes(x = diamond_col_name[d])) + -->
<!--              #geom_bar() -->
<!--   #} -->
<!-- #} -->

<!-- ``` -->




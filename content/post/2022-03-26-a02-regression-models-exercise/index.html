---
title: 'A02: Regression Models Exercise'
author: ''
date: '2022-03-26'
slug: a02-regression-models-exercise
categories: []
tags: []
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<div id="setup" class="section level1">
<h1>Setup</h1>
<pre class="r"><code>if(!require(&quot;pacman&quot;)) install.packages(&quot;pacman&quot;)</code></pre>
<pre><code>## Loading required package: pacman</code></pre>
<pre><code>## Warning: package &#39;pacman&#39; was built under R version 4.1.3</code></pre>
<pre class="r"><code>pacman::p_load(pacman,readxl, magrittr, productplots, psych, RColorBrewer, tidyverse, boot)
diamonds &lt;- read_csv(&quot;https://raw.githubusercontent.com/vsomesula/COPwebsite/main/content/post/2022-03-26-a02-regression-models-exercise/Professor_Proposes_Data.csv&quot;)</code></pre>
<pre><code>## Rows: 440 Columns: 9</code></pre>
<pre><code>## -- Column specification --------------------------------------------------------
## Delimiter: &quot;,&quot;
## chr (7): Colour, Clarity, Cut, Certification, Polish, Symmetry, Price
## dbl (2): Carat, Wholesaler
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code>attach(diamonds)
diamonds$Colour &lt;- as.factor(Colour)
diamonds$Clarity &lt;- as.factor(Clarity)
diamonds$Cut &lt;- as.factor(Cut)
diamonds$Certification &lt;- as.factor(Certification)
diamonds$Polish &lt;- as.factor(Polish)
diamonds$Symmetry &lt;- as.factor(Symmetry)
diamonds$Wholesaler &lt;- as.factor(Wholesaler)
diamonds</code></pre>
<pre><code>## # A tibble: 440 x 9
##    Carat Colour Clarity Cut   Certification Polish Symmetry Price Wholesaler
##    &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;   &lt;fct&gt; &lt;fct&gt;         &lt;fct&gt;  &lt;fct&gt;    &lt;dbl&gt; &lt;fct&gt;     
##  1  0.92 I      SI2     G     AGS           V      V         3000 1         
##  2  0.92 I      SI2     V     AGS           G      G         3000 1         
##  3  0.82 F      SI2     I     GIA           X      X         3004 1         
##  4  0.81 G      SI1     I     GIA           X      V         3004 1         
##  5  0.9  J      VS2     V     GIA           V      V         3006 1         
##  6  0.87 F      SI2     I     AGS           G      V         3007 1         
##  7  0.8  D      SI2     I     GIA           V      V         3008 1         
##  8  0.84 F      SI1     G     GIA           V      V         3010 1         
##  9  0.8  D      SI2     V     GIA           V      V         3012 1         
## 10  0.8  D      SI2     V     GIA           V      X         3012 1         
## # ... with 430 more rows</code></pre>
<p>#Graphing and frequency counting of each variable</p>
<pre class="r"><code>diamonds %&gt;%
  ggplot() +
  geom_bar(aes(Carat, fill =  Carat)) +
  theme(
    axis.title.x = element_blank(),
    legend.position = &quot;none&quot;
  )</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code>count(diamonds, Carat)</code></pre>
<pre><code>## # A tibble: 50 x 2
##    Carat     n
##    &lt;dbl&gt; &lt;int&gt;
##  1  0.09     5
##  2  0.1     13
##  3  0.11     5
##  4  0.2      1
##  5  0.21     7
##  6  0.22     5
##  7  0.23     7
##  8  0.27     1
##  9  0.28     2
## 10  0.3    154
## # ... with 40 more rows</code></pre>
<pre class="r"><code>diamonds %&gt;%
  ggplot() +
  geom_bar(aes(Colour, fill =  Colour)) +
  theme(
    axis.title.x = element_blank(),
    legend.position = &quot;none&quot;
  )</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
<pre class="r"><code>count(diamonds, Colour)</code></pre>
<pre><code>## # A tibble: 9 x 2
##   Colour     n
##   &lt;fct&gt;  &lt;int&gt;
## 1 D         20
## 2 E         54
## 3 F         58
## 4 G         43
## 5 H         71
## 6 I         79
## 7 J         72
## 8 K         31
## 9 L         12</code></pre>
<pre class="r"><code>diamonds %&gt;%
  ggplot() +
  geom_bar(aes(Clarity, fill =  Clarity)) +
  theme(
    axis.title.x = element_blank(),
    legend.position = &quot;none&quot;
  )</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-4-3.png" width="672" /></p>
<pre class="r"><code>count(diamonds, Clarity)</code></pre>
<pre><code>## # A tibble: 9 x 2
##   Clarity     n
##   &lt;fct&gt;   &lt;int&gt;
## 1 I1         82
## 2 I2         28
## 3 SI1       116
## 4 SI2       110
## 5 SI3        26
## 6 VS1        30
## 7 VS2        41
## 8 VVS1        2
## 9 VVS2        5</code></pre>
<pre class="r"><code>diamonds %&gt;%
  ggplot() +
  geom_bar(aes(Cut, fill =  Cut)) +
  theme(
    axis.title.x = element_blank(),
    legend.position = &quot;none&quot;
  )</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-4-4.png" width="672" /></p>
<pre class="r"><code>count(diamonds, Cut)</code></pre>
<pre><code>## # A tibble: 5 x 2
##   Cut       n
##   &lt;fct&gt; &lt;int&gt;
## 1 F        59
## 2 G        49
## 3 I        86
## 4 V        97
## 5 X       149</code></pre>
<pre class="r"><code>diamonds %&gt;%
  ggplot() +
  geom_bar(aes(Certification, fill =  Certification)) +
  theme(
    axis.title.x = element_blank(),
    legend.position = &quot;none&quot;
  )</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-4-5.png" width="672" /></p>
<pre class="r"><code>count(diamonds, Certification)</code></pre>
<pre><code>## # A tibble: 5 x 2
##   Certification     n
##   &lt;fct&gt;         &lt;int&gt;
## 1 AGS              12
## 2 DOW               1
## 3 EGL             119
## 4 GIA             265
## 5 IGI              43</code></pre>
<pre class="r"><code>diamonds %&gt;%
  ggplot() +
  geom_bar(aes(Polish, fill =  Polish)) +
  theme(
    axis.title.x = element_blank(),
    legend.position = &quot;none&quot;
  )</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-4-6.png" width="672" /></p>
<pre class="r"><code>count(diamonds, Polish)</code></pre>
<pre><code>## # A tibble: 6 x 2
##   Polish     n
##   &lt;fct&gt;  &lt;int&gt;
## 1 F          5
## 2 G        165
## 3 I          5
## 4 v          1
## 5 V        203
## 6 X         61</code></pre>
<pre class="r"><code>diamonds %&gt;%
  ggplot() +
  geom_bar(aes(Symmetry, fill =  Symmetry)) +
  theme(
    axis.title.x = element_blank(),
    legend.position = &quot;none&quot;
  )</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-4-7.png" width="672" /></p>
<pre class="r"><code>count(diamonds, Symmetry)</code></pre>
<pre><code>## # A tibble: 5 x 2
##   Symmetry     n
##   &lt;fct&gt;    &lt;int&gt;
## 1 F           21
## 2 G          157
## 3 I            5
## 4 V          206
## 5 X           51</code></pre>
<pre class="r"><code>diamonds %&gt;%
  ggplot() +
  geom_bar(aes(Wholesaler, fill =  Wholesaler)) +
  theme(
    axis.title.x = element_blank(),
    legend.position = &quot;none&quot;
  )</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-4-8.png" width="672" /></p>
<pre class="r"><code>count(diamonds, Wholesaler)</code></pre>
<pre><code>## # A tibble: 3 x 2
##   Wholesaler     n
##   &lt;fct&gt;      &lt;int&gt;
## 1 1             60
## 2 2            180
## 3 3            200</code></pre>
</div>
<div id="explaotory-analysis" class="section level1">
<h1>Explaotory Analysis</h1>
<div id="this-type-of-model-will-give-us-an-equation-where-we-can-use-as-many-of-the-categorial-variables-as-we-want.-we-can-imagine-it-as-cutgx1-cutix2-..-with-their-respective-coefficents.-with-each-duiamond-if-it-has-cut-level-of-g-than-x2-x3-etc-for-that-category-will-be-0-leaving-us-only-with-the-weight-for-cut-g.-this-will-leave-us-a-very-convuluted-model-however-as-seen-below.-we-will-remove-wholesaler-as-it-is-three-different-websites-from-which-the-information-was-obtained-which-means-it-should-be-three-different-models-i.e.-wholesaler-is-not-an-indepdent-variable" class="section level2">
<h2>This type of model will give us an equation where we can use as many of the categorial variables as we want. We can imagine it as CutGx1 + CutIx2 + .. with their respective coefficents. With each duiamond if it has Cut level of G than x2, x3, etc for that category will be 0 leaving us only with the weight for Cut G. This will leave us a very convuluted model however as seen below. We will remove wholesaler as it is three different websites from which the information was obtained which means it should be three different models (i.e.Â wholesaler is not an indepdent variable)</h2>
<pre class="r"><code>lm.fit &lt;- lm(Price~Carat + Colour + Clarity +Cut + Certification + Polish + Symmetry, data = diamonds)
summary(lm.fit)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Price ~ Carat + Colour + Clarity + Cut + Certification + 
##     Polish + Symmetry, data = diamonds)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -762.63  -82.58  -18.59  101.42  689.59 
## 
## Coefficients: (1 not defined because of singularities)
##                    Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)      -1432.6219   146.6961  -9.766  &lt; 2e-16 ***
## Carat             4205.3391    51.2981  81.978  &lt; 2e-16 ***
## ColourE           -191.2462    53.5345  -3.572 0.000396 ***
## ColourF           -311.1620    53.6267  -5.802 1.32e-08 ***
## ColourG           -301.4412    54.5157  -5.529 5.76e-08 ***
## ColourH           -430.3664    53.0617  -8.111 6.03e-15 ***
## ColourI           -500.9400    53.0827  -9.437  &lt; 2e-16 ***
## ColourJ           -635.8407    54.6431 -11.636  &lt; 2e-16 ***
## ColourK           -985.9734    61.0240 -16.157  &lt; 2e-16 ***
## ColourL          -1173.6677    76.3472 -15.373  &lt; 2e-16 ***
## ClarityI2         -778.3139    50.8010 -15.321  &lt; 2e-16 ***
## ClaritySI1         858.5738    43.2466  19.853  &lt; 2e-16 ***
## ClaritySI2         731.5613    35.6145  20.541  &lt; 2e-16 ***
## ClaritySI3         388.9407    49.2119   7.903 2.58e-14 ***
## ClarityVS1        1025.1681    59.0373  17.365  &lt; 2e-16 ***
## ClarityVS2         915.4216    53.2913  17.178  &lt; 2e-16 ***
## ClarityVVS1       1342.8683   154.7169   8.680  &lt; 2e-16 ***
## ClarityVVS2        918.2219   101.0745   9.085  &lt; 2e-16 ***
## CutG                56.4835    41.8846   1.349 0.178233    
## CutI                95.4908    40.9225   2.333 0.020112 *  
## CutV                84.1675    41.5654   2.025 0.043527 *  
## CutX                56.8290    35.7071   1.592 0.112269    
## CertificationDOW  -500.9363   223.5204  -2.241 0.025558 *  
## CertificationEGL  -418.0748    81.9208  -5.103 5.13e-07 ***
## CertificationGIA   -64.8962    80.6771  -0.804 0.421640    
## CertificationIGI     0.2533    94.8367   0.003 0.997871    
## PolishG            210.9384   106.7503   1.976 0.048832 *  
## PolishI            461.4891   156.8392   2.942 0.003443 ** 
## Polishv            265.1641   230.8040   1.149 0.251286    
## PolishV            226.5659   110.6450   2.048 0.041234 *  
## PolishX            236.0952   113.7270   2.076 0.038524 *  
## SymmetryG          108.1495    57.3953   1.884 0.060239 .  
## SymmetryI                NA         NA      NA       NA    
## SymmetryV          119.4279    61.2390   1.950 0.051841 .  
## SymmetryX          113.5676    68.3626   1.661 0.097435 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 197.2 on 406 degrees of freedom
## Multiple R-squared:  0.974,  Adjusted R-squared:  0.9719 
## F-statistic: 460.4 on 33 and 406 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div id="we-can-use-this-model-for-testing-however-through-code-to-see-the-results.-in-a-completely-accurate-world-if-we-had-the-wholesaler-from-which-the-professor-was-buying-from-assuming-it-was-12-or-3-we-could-make-three-different-models-and-see-if-he-was-getting-a-fair-price-for-his-diamond" class="section level2">
<h2>We can use this model for testing however through code to see the results. In a completely accurate world, if we had the wholesaler from which the professor was buying from (assuming it was 1,2, or 3) we could make three different models and see if he was getting a fair price for his diamond</h2>
<pre class="r"><code>df &lt;- data.frame(Carat = 0.9, Colour = &quot;J&quot;, Clarity = &quot;SI2&quot;, Cut = &quot;V&quot;, Certification = &quot;GIA&quot;, Polish = &quot;G&quot;, Symmetry = &quot;V&quot;)
as_tibble(df)</code></pre>
<pre><code>## # A tibble: 1 x 7
##   Carat Colour Clarity Cut   Certification Polish Symmetry
##   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;   
## 1   0.9 J      SI2     V     GIA           G      V</code></pre>
<pre class="r"><code>df$Colour &lt;- as.factor(df$Colour)
df$Clarity &lt;- as.factor(df$Clarity)
df$Cut &lt;- as.factor(df$Cut)
df$Certification &lt;- as.factor(df$Certification)
df$Polish &lt;- as.factor(df$Polish)
df$Symmetry &lt;- as.factor(df$Symmetry)
#df$Wholesaler &lt;- as.factor(df$Wholesaler)
df</code></pre>
<pre><code>##   Carat Colour Clarity Cut Certification Polish Symmetry
## 1   0.9      J     SI2   V           GIA      G        V</code></pre>
<pre class="r"><code>predict(lm.fit, df )</code></pre>
<pre><code>## Warning in predict.lm(lm.fit, df): prediction from a rank-deficient fit may be
## misleading</code></pre>
<pre><code>##        1 
## 2797.542</code></pre>
</div>
</div>
<div id="boot-strap-validation" class="section level1">
<h1>Boot strap validation</h1>
<pre class="r"><code>boot.fn &lt;- function(data, index){
  return(coef(lm(Price~Carat + Colour + Clarity +Cut + Certification + Polish + Symmetry+Wholesaler, data = diamonds)))
}
set.seed(1)
boot.out &lt;- boot(diamonds, boot.fn, 1000)
plot(boot.out)</code></pre>
<pre><code>## [1] &quot;All values of t* are equal to  788.883051812151&quot;</code></pre>
</div>
<div id="k-fold-validation-will-not-work-unless-we-use-stratified-sort-or-use-dummy-variables" class="section level1">
<h1>K fold validation will not work unless we use stratified sort or use dummy variables</h1>
<pre class="r"><code>K = 10
glm.fit &lt;- glm(Price~ Carat + Colour + Clarity +Cut + Certification + Polish + Symmetry, data =  diamonds)
cv.error &lt;- cv.glm(diamonds, glm.fit, K = K)$delta[1]</code></pre>
<pre><code>## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading</code></pre>
<pre><code>## Error in model.frame.default(Terms, newdata, na.action = na.action, xlev = object$xlevels): factor Certification has new levels DOW</code></pre>
<!-- ### Junk Transformation of Colour variable so that the groups of letter all correspond to the correct grouping -->
<!-- ```{r} -->
<!-- for(v in 1:440){ -->
<!-- if(diamonds$Colour[v] == "D"|| diamonds$Colour[v] == "E"|| diamonds$Colour[v] == "F") -->
<!-- { -->
<!--   diamonds$Colour[v] = 1 -->
<!-- } else if(diamonds$Colour[v] == "G"|| diamonds$Colour[v] == "H"|| diamonds$Colour[v] == "I") { -->
<!--   diamonds$Colour[v] = 2 -->
<!-- } else if(diamonds$Colour[v] == "J"|| diamonds$Colour[v] == "K") { -->
<!--   diamonds$Colour[v] = 3 -->
<!-- } else if(diamonds$Colour[v] == "L"|| diamonds$Colour[v] == "M"|| diamonds$Colour[v] == "N") { -->
<!--   diamonds$Colour[v] = 4 -->
<!-- } else if(diamonds$Colour[v] == "O"|| diamonds$Colour[v] == "P"|| diamonds$Colour[v] == "Q"|| diamonds$Colour[v] == "R"|| diamonds$Colour[v] == "S") { -->
<!--   diamonds$Colour[v] = 5 -->
<!-- } else  { -->
<!--   diamonds$Colour[v] = 6 -->
<!-- }  -->
<!-- } -->
<!-- ``` -->
<!-- #### Junk -->
<!-- ```{r} -->
<!-- diamonds <- read_excel("C:/Users/prana/Downloads/Professor_Proposes_Data.xlsx") -->
<!-- attach(diamonds) -->
<!-- diamonds$Colour[1] = "I" -->
<!-- if(diamonds$Colour[5] == "I" || diamonds$Colour[5] == "J") -->
<!-- { -->
<!--   diamonds$Colour[5] = 1 -->
<!-- } -->
<!-- diamonds$Colour[5] -->
<!-- #lm.fit <- lm(Price ~ Cut, data = diamonds) -->
<!-- #lm.fit -->
<!-- diamond_col_name <- colnames(diamonds) -->
<!-- #for (d in 1:9) { -->
<!--  # if(d !==8){ -->
<!--   #  lmfao[d] <- diamond_col_name[d] -->
<!--    # ggplot(diamonds, aes(x = diamond_col_name[d])) + -->
<!--              #geom_bar() -->
<!--   #} -->
<!-- #} -->
<!-- ``` -->
</div>
